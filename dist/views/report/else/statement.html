<title>其他报表</title>
<div class="layui-card layadmin-header">
	<div class="layui-breadcrumb" lay-filter="breadcrumb">
		<a lay-href="">报表中心</a>
		<a><cite>其他报表</cite></a>
	</div>
</div>

<div class="layui-fluid" style="background-color: #fff!important;">
	<div class="layui-card">
		<div class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="app-content-list">
			<!--其他报表-->
			<div class="layui-form-item">
				<div class="layui-inline">
					<button class="layui-btn layuiadmin-btn-list">证书查询</button>
				</div>
			</div>

			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">部门名称</label>
					<div class="layui-input-inline">
						<input type="text" name="" lay-verify="" placeholder="部门名称" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">职务级别</label>
					<div class="layui-input-inline">
						<select name="buttonTpl" lay-verify="" lay-search="">
							<option value="">--请选择--</option>
							<option value="1">主任</option>
							<option value="2">经理</option>
							<option value="3">工人</option>
							<option value="4">科员</option>
							<option value="5">总监</option>
							<option value="6">文员</option>
							<option value="7">主管</option>
							<option value="8">互动专员</option>
						</select>
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">职务类型</label>
					<div class="layui-input-inline">
						<select name="buttonTpl" lay-verify="" lay-search="">
							<option value="">--请选择--</option>
							<option value="1">IT</option>
							<option value="2">保险产品</option>
							<option value="3">财务</option>
							<option value="4">采购</option>
							<option value="5">客服</option>
							<option value="6">人力资源</option>
							<option value="7">市场</option>
							<option value="8">销售</option>
						</select>
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">职务名称</label>
					<div class="layui-input-inline">
						<select name="buttonTpl" lay-verify="" lay-search="">
							<option value="">--请选择--</option>
							<option value="1">人事专员</option>
							<option value="2">人事专员</option>
							<option value="3">项目经理</option>
						</select>
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">员工姓名</label>
					<div class="layui-input-inline">
						<input type="text" name="" lay-verify="" placeholder="员工姓名" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">证书名称</label>
					<div class="layui-input-inline">
						<select name="buttonTpl" lay-verify="" lay-search="">
							<option value="">--请选择--</option>
							<option value="1">压力容器操作证</option>
							<option value="2">内部讲师证</option>
							<option value="3">秘书证</option>
							<option value="4">教练证</option>
							<option value="5">电焊证</option>
							<option value="6">叉车证</option>
							<option value="7">SPC专业证书</option>
							<option value="8">QCC专业证书</option>
							<option value="9">MBA学历证书</option>
							<option value="10">西格玛黑带</option>
						</select>
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">截至日期</label>
					<div class="layui-input-inline">
						<input type="text" name="" lay-verify="" placeholder="yyyy-mm-dd" autocomplete="off" class="layui-input date">
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="layui-card-body">
		<div style="padding-bottom: 10px;">
			<button class="layui-btn layuiadmin-btn-list" data-type="">数据列表</button>
			<!-- 搜索按钮 -->
			<button class="layui-btn layuiadmin-btn-list" lay-submit lay-filter="LAY-app-contlist-search">
				<i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>查询
			</button>
		</div>
		<table id="LAY-report-statement-else" lay-filter="LAY-report-statement-else"></table>
	</div>
</div>

<script>
	layui.use(['admin', 'contlist', 'table', 'form', 'laydate'], function() {
		var $ = layui.$,
			admin = layui.admin,
			view = layui.view,
			table = layui.table,
			laydate = layui.laydate,
			form = layui.form;

		//表格渲染
		table.render({
				elem: '#LAY-report-statement-else',
				url: commonSrc + '',
				request: {
					pageName: 'pageNum' //页码的参数名称，默认：page
						,
					limitName: 'pageSize' //每页数据量的参数名，默认：limit
				},
				response: {
					statusCode: 200 //规定成功的状态码，默认：0
				},
				parseData: function(res) { //res 即为原始返回的数据
					return {
						"code": res.code, //解析接口状态
						"msg": res.desc, //解析提示文本
						"count": res.total, //解析数据长度
						"data": res.dataList //解析数据列表
					};
				},
				cols: [
					[{
						type: 'checkbox',
						fixed: "left"
					}, {
						field: 'id',
						title: 'id',
						hide: true
					}, {
						field: 'commonId',
						title: '申请公共id',
						hide: true
					}, {
						type: 'applyId',
						title: '申请人id',
						fixed: "left",
						hide: true
					}, {
						field: 'applyName',
						title: '申请人姓名',
						align: 'center'
					}, {
						field: 'countDay',
						title: '休假总天数',
						align: 'center'
					}, {
						field: 'countHour',
						title: '休假总小时数',
						align: 'center'

					}, {
						field: 'endTime',
						title: '请假结束日期',
						align: 'center'
					}, {
						field: 'extension',
						title: '临时代理人分机',
						align: 'center'
					}, {
						field: 'linkTel',
						title: '联系电话',
						align: 'center'
					},{
						fixed: 'right',
						title: '操作',
						toolbar: '#table-content-list',
						minWidth: 150
					}]
				],
				page: !0,
				limit: 10,
				limits: [10, 15, 20, 25, 30],
			}),
			table.on("tool(LAY-report-statement-else)", function(obj) {
				var data = obj.data;
				"del" === obj.event ? layer.confirm("确定删除申请？", function(e) {
						$.ajax({
							url: commonSrc + "api/hr/holidayApplyController/deleteHolidayApply", //换成自己的url
							type: "GET",
							dataType: "json",
							data: {
								id: data.id,
							},
							success: function(b) {
								table.reload('LAY-report-statement-else');
								layer.msg('删除成功');
								obj.del(), layer.close(e)
							},
							error: function(e) {
								layer.msg('删除失败')
								layer.msg(e);
							}
						})
					}) :
					"edit" === obj.event && admin.popup({
						title: "编辑休假申请",
						area: ['720px', '700px'],
						id: "LAY-popup-content-edit",
						success: function(t, layero) {
							view(this.id).render("apply/Leave/testform", data).done(function() {
								$.ajax({
									url: commonSrc + "api/hr/holidayApplyController/selectHolidayApply", //换成自己的url
									type: "GET",
									dataType: "json",
									data: {
										id: data.id
									},
									success: function(e) {
										//layer.msg(e.contractCheckVo);
										let obj = e.data;
										form.val("layuiadmin-app-form-list", {
											"id": obj.id,
											"applyId": obj.applyId,
											"applyName": obj.applyName,
											"countDay": obj.countDay,
											"countHour": obj.countHour,
											"endTime": obj.endTime,
											"extension": obj.extension,
											"linkTel": obj.linkTel,
											"name": obj.name,
											"proxyName": obj.proxyName,
											"reason": obj.reason,
											"remark": obj.remark,
											"startTime": obj.startTime,
											"type": obj.type,
											"updated_by": obj.updated_by,
										});

										$(".date").each(function() {
											laydate.render({
												elem: this,
												trigger: 'click',
											});
										})
									},
									error: function(e) {
										layer.msg(e);
									}
								})
								form.render(null, "layuiadmin-app-form-list"), form.on("submit(layuiadmin-app-form-submit)", function(
									data) {
									$.post(commonSrc + "api/hr/holidayApplyController/updateHolidayApply",
										data.field,
										function(ev) {
											layer.msg("修改成功", {
												time: 1000
											}, function() {
												layui.table.reload("LAY-report-statement-else"), layer.close(layero)
											})
										});
									return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
								})
							})
						}
					})
			})


		form.render(null, 'app-content-list');

		//监听搜索
		form.on('submit(LAY-app-contlist-search)', function(data) {
			var field = data.field;
			console.log(field);
			//执行重载
			table.reload('LAY-report-statement-else', {
				where: field
			});
		});

		var active = {
			batchdel: function() {
					var checkStatus = table.checkStatus('LAY-report-statement-else'),
						checkData = checkStatus.data; //得到选中的数据
					if (checkData.length === 0) {
						return layer.msg('请选择数据');
					}
					let arr = "";
					let arrTwo = "";
					for (var i in checkData) {
						arr += checkData[i].id + ",";
					}
					for (var i in checkData) {
						arrTwo += checkData[i].commonId + ",";
					}
					layer.confirm('确定删除吗？', function(index) {
						$.ajax({
							type: "GET",
							url: commonSrc + "api/hr/holidayApplyController/deleteMultipleHolidayApply",
							dataType: "json",
							data: {
								ids: arr,
							},
							success: function(json) {
								table.reload('LAY-report-statement-else');
								layer.msg('已删除');
							}
						});

						//执行 Ajax 后重载
						/*
						
									*/
					});
				}

				//添加
				,
			add: function(othis) {
				admin.popup({
					title: '添加休假申请',
					area: ['720px', '700px'],
					id: 'LAY-popup-content-add',
					success: function(layero, index) {
						view(this.id).render('apply/leave/testform').done(function() {
							form.render(null, 'layuiadmin-app-form-list');
							//日期
							$(".date").each(function() {
								laydate.render({
									elem: this,
									trigger: 'click',
								});
							})
							//监听提交
							form.on('submit(layuiadmin-app-form-submit)', function(data) {
								var field = data.field; //获取提交的字段
								$.post(commonSrc + "api/hr/holidayApplyController/insertHolidayApply",
									data.field,
									function(ev) {
										layer.msg("新增成功", {
											time: 1000
										}, function() {
											layer.close(index); //执行关闭 
											layui.table.reload('LAY-report-statement-else'); //重载表格
										})
									});
								return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
							});
						});
					}
				});
			}
		};
		$('.layui-btn.layuiadmin-btn-list').on('click', function() {
			var type = $(this).data('type');
			active[type] ? active[type].call(this) : '';
		});
		//日期
		$(".date").each(function() {
			laydate.render({
				elem: this,
				trigger: 'click',
			});
		})

	});
</script>
