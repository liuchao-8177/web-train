<div class="layui-form" lay-filter="layuiadmin-app-form-list" id="layuiadmin-app-form-list" style="padding: 20px 30px 0 0;">
	<div class="layui-form-item">
		<label class="layui-form-label">课程类型</label>
		<div class="layui-input-inline" id="layerDemo">
					<script type="text/html" template>
						<!--<input type="text" name="attributeId" lay-verify="title" autocomplete="off" placeholder="证书等级" class="layui-input">-->
						<select name="typeId" lay-search="" id="editCourseTypeId" lay-filter="editCourseTypeId" class="layui-form">
							<option value="">请选择</option>
						</select>
					</script>
				</div>
		<label class="layui-form-label">课程属性</label>
		<div class="layui-input-inline" id="layerBute">
			<script type="text/html" template>
				<!--<input type="text" name="attributeId" lay-verify="title" autocomplete="off" placeholder="证书等级" class="layui-input">-->
					<select name="attributeId" lay-search="" id="editCourseAttributeId" lay-filter="editCourseAttributeId" class="layui-form">
						<option value="">请选择</option>
					</select>
				</script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">课时(H)</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<input type="text" name="hours" lay-verify="title" autocomplete="off" placeholder="课时(H)" class="layui-input">
			</script>
		</div>
		<label class="layui-form-label">证书等级</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<input type="text" name="cerLevel" lay-verify="title" autocomplete="off" placeholder="证书等级" class="layui-input">
	        </script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">有效天数</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<input type="text" name="validDay" lay-verify="title" autocomplete="off" placeholder="有效天数" class="layui-input">
			</script>
		</div>
		<label class="layui-form-label">到岗x天培训</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<input type="text" name="arrivalDay" lay-verify="title" autocomplete="off" placeholder="到岗x天培训" class="layui-input">
	        </script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">快捷码</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<input type="text" name="fastCode" lay-verify="title" autocomplete="off" placeholder="快捷码" class="layui-input">
        </script>
		</div>
		<label class="layui-form-label">部门级</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<select name="isDept">
				<option value="">--请选择--</option>
				<option value="1">是</option>
				<option value="2">否</option>
			</select>
			</script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">启动</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<select name="isUse">
				<option value="">--请选择--</option>
				<option value="1">是</option>
				<option value="2">否</option>
			</select>
			</script>
		</div>
		<label class="layui-form-label">优先级别</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<select name="priority">
				<option value="">--请选择--</option>
				<option value="1">必修</option>
				<option value="2">选修</option>
			</select>
			</script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">租户编码</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<input type="text" name="tenantCode"  lay-verify="title" placeholder="租户编码" autocomplete="off" class="layui-input" />
						</script>
		</div>
		<label class="layui-form-label">等效课程</label>
		<div class="layui-input-inline">
			<div class="layui-input-inline">
				<script type="text/html" template>
					<input type="text" name="topic"  lay-verify="title" placeholder="等效课程" autocomplete="off" class="layui-input" />
				</script>
			</div>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">培训形式</label>
		<div class="layui-input-inline">
			<script type="text/html" template>
				<select name="traForm">
				<option value="">--请选择--</option>
				<option value="1">外部公开课</option>
				<option value="2">外聘培训</option>
				<option value="3">内部培训</option>
			</select>
			</script>
		</div>

	</div>
	<script type="text/html" template>
		<input type="hidden" name="id" />
</script>


	<script type="text/javascript">
		layui.use(['form'], function() {
			var form = layui.form; //form模块
			var $ = layui.$; //引入内置jquery


			ajax_courseType();
			ajax_courseAttribute();

			//  课程类型
			function ajax_courseType() {
				// 清空原有select内的数据  只保留第一项
				$("#editCourseTypeId").find("option:not(:first)").remove();
				form.render('select', 'editCourseTypeId'); //渲染表单
				$.ajax({
					url: commonSrc + "api/train/courseTypeController/list",
					type: "get",
					dataType: "json",
					success: function(res) {
						var data = res.dataList;
						$.each(data, function(i, v) {
							var id = v.id;
							var text = v.typeName;
							// alert(id + text);
							$("#editCourseTypeId").append("<option value='" + id + "'>" + text + "</option>");
						});
						//渲染select 表单  filter 是 重新渲染对象
						form.render('select', 'editCourseTypeId');
					},
					error: function() {
						// alert(errorThrown);
					}
				});
			}

			//  课程属性
			function ajax_courseAttribute() {
				// 清空原有select内的数据  只保留第一项
				$("#editCourseAttributeId").find("option:not(:first)").remove();
				form.render('select', 'editCourseAttributeId'); //渲染表单
				$.ajax({
					url: commonSrc + "api/train/courseAttributeController/list",
					type: "get",
					dataType: "json",
					success: function(res) {
						var data = res.dataList;
						$.each(data, function(i, v) {
							var id = v.id;
							var text = v.attrName;
							// alert(id + text);
							$("#editCourseAttributeId").append("<option value='" + id + "'>" + text + "</option>");
						});
						//渲染select 表单  filter 是 重新渲染对象
						form.render('select', 'editCourseAttributeId');
					},
					error: function() {
						// alert(errorThrown);
					}
				});
			}
		});
	</script>
	<!-- 相关附件及子课程 begin -->
	<div class="layui-fluid">
		<div class="layui-card">
			<div class="layui-tab">
				<ul class="layui-tab-title">
					<li class="layui-this">相关课件</li>
					<li>子课程</li>
				</ul>
				<div class="layui-tab-content">
					<!--相关课件bengin  -->
					<div class="layui-tab-item layui-show">
			
					</div>
					<!--相关课件end  -->

					<!--子课件bengin  -->
					<div class="layui-tab-item">

						<section class="layui-col-md10" style="margin: 0 auto; float: none;">
							<div class="layui-card">
								<div id="toolbar">
									<div>
										<button type="button" class="layui-btn layui-btn-sm" data-type="add" title="添加">
											<i class="layui-icon layui-icon-add-1"></i> 添加
										</button>
									</div>
								</div>
								<div id="tableRes" class="table-overlay">
									<table id="dataTable" lay-filter="dataTable" class="layui-hide"></table>
								</div>
							</div>

						</section>
						<script type="text/javascript">
							//准备视图对象
							window.viewObj = {
								tbData: [{
									tempId: new Date().valueOf(),
									type: 2,
									name: '测试项名称',
									state: 1
								}],
								typeData: [{
										id: 1,
										name: '分类一'
									},
									{
										id: 2,
										name: '分类二'
									},
									{
										id: 3,
										name: '分类三'
									},
									{
										id: 4,
										name: '分类四'
									}
								],
								renderSelectOptions: function(data, settings) {
									settings = settings || {};
									var valueField = settings.valueField || 'value',
										textField = settings.textField || 'text',
										selectedValue = settings.selectedValue || "";
									var html = [];
									for (var i = 0, item; i < data.length; i++) {
										item = data[i];
										html.push('<option value="');
										html.push(item[valueField]);
										html.push('"');
										if (selectedValue && item[valueField] == selectedValue) {
											html.push(' selected="selected"');
										}
										html.push('>');
										html.push(item[textField]);
										html.push('</option>');
									}
									return html.join('');
								}
							};

							//layui 模块化引用
							layui.use(['jquery', 'table', 'layer'], function() {
								var $ = layui.$,
									table = layui.table,
									form = layui.form,
									layer = layui.layer;

								//数据表格实例化			
								var tbWidth = $("#tableRes").width();
								var layTableId = "layTable";
								var tableIns = table.render({
									elem: '#dataTable',
									id: layTableId,
									data: viewObj.tbData,
									width: tbWidth,
									page: false,
									loading: true,
									even: false, //不开启隔行背景
									cols: [
										[{
												title: '序号',
												type: 'numbers'
											},
											{
												field: 'name',
												title: '子课程名称',
												edit: 'text'
											},
											{
												field: 'state',
												title: '默认讲师名',
												edit: 'text'
											},
											{
												field: 'tempId',
												title: '操作',
												templet: function(d) {
													return '<a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del" lay-id="' + d.tempId +
														'"><i class="layui-icon layui-icon-delete"></i>移除</a>';
												}
											}
										]
									],
									done: function(res, curr, count) {
										viewObj.tbData = res.data;
									}
								});

								//定义事件集合
								var active = {
									add: function() { //添加一行
										var oldData = table.cache[layTableId];
										var newRow = {
											tempId: new Date().valueOf(),
											type: null,
											name: '请填写名称',
											state: 0
										};
										oldData.push(newRow);
										tableIns.reload({
											data: oldData
										});
									},
									updateRow: function(obj) {
										var oldData = table.cache[layTableId];
										for (var i = 0, row; i < oldData.length; i++) {
											row = oldData[i];
											if (row.tempId == obj.tempId) {
												$.extend(oldData[i], obj);
												return;
											}
										}
										tableIns.reload({
											data: oldData
										});
									},
									removeEmptyTableCache: function() {
										var oldData = table.cache[layTableId];
										for (var i = 0, row; i < oldData.length; i++) {
											row = oldData[i];
											if (!row || !row.tempId) {
												oldData.splice(i, 1); //删除一项
											}
											continue;
										}
										tableIns.reload({
											data: oldData
										});
									},
									save: function() {
										var oldData = table.cache[layTableId];
										for (var i = 0, row; i < oldData.length; i++) {
											row = oldData[i];
											if (!row.type) {
												layer.msg("检查每一行，请选择分类！", {
													icon: 5
												}); //提示
												return;
											}
										}
										document.getElementById("jsonResult").innerHTML = JSON.stringify(table.cache[layTableId], null, 2); //使用JSON.stringify() 格式化输出JSON字符串		
									}
								}

								//激活事件
								var activeByType = function(type, arg) {
									if (arguments.length === 2) {
										active[type] ? active[type].call(this, arg) : '';
									} else {
										active[type] ? active[type].call(this) : '';
									}
								}

								//注册按钮事件
								$('.layui-btn[data-type]').on('click', function() {
									var type = $(this).data('type');
									activeByType(type);
								});

								//监听select下拉选中事件
								form.on('select(type)', function(data) {
									var elem = data.elem; //得到select原始DOM对象
									$(elem).prev("a[lay-event='type']").trigger("click");
								});

								//监听工具条
								table.on('tool(dataTable)', function(obj) {
									var data = obj.data,
										event = obj.event,
										tr = obj.tr; //获得当前行 tr 的DOM对象;
									switch (event) {
										case "type":
											//console.log(data);
											var select = tr.find("select[name='type']");
											if (select) {
												var selectedVal = select.val();
												if (!selectedVal) {
													layer.tips("请选择一个分类", select.next('.layui-form-select'), {
														tips: [3, '#FF5722']
													}); //吸附提示
												}
												$.extend(obj.data, {
													'type': selectedVal
												});
												activeByType('updateRow', obj.data); //更新行记录对象
											}
											break;
										case "state":
											var stateVal = tr.find("input[name='state']").prop('checked') ? 1 : 0;
											$.extend(obj.data, {
												'state': stateVal
											})
											activeByType('updateRow', obj.data); //更新行记录对象
											break;
										case "del":
											layer.confirm('真的删除行么？', function(index) {
												obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
												layer.close(index);
												activeByType('removeEmptyTableCache');
											});
											break;
									}
								});
							});
						</script>

					</div>

					<!--子课件end  -->
				</div>
			</div>
		</div>
	</div>

	<div class="layui-form-item">
		<label class="layui-form-label"></label>
		<div class="layui-input-inline">
			<input type="button" lay-submit lay-filter="layuiadmin-app-form-submit" value="确认" class="layui-btn">
		</div>
	</div>
</div>
